@using PagedList.Mvc;
@using Model1
@model  ModelCollection


@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

@section header{
    <b class="panel-heading" style="color:black; font-size:x-large">
        Nhập cấp phát vắc xin/Vật tư
    </b>
}

@section jsFooter{
    <script src="~/Assets/Admin/js/jquery-3.6.0.min.js"></script>
    <script src="~/Assets/Admin/css/lib/combobox.js"></script>
    <script>
        var element = document.getElementById("nguon").value;
        document.getElementById("sophieu").value = element;</script>
}

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="~/Assets/Admin/css/main.css">
    <link rel="stylesheet" href="~/Assets/Admin/css/thuan-main.css">
    <link rel="stylesheet" href="~/Assets/Admin/css/page/user.css">
    <link rel="stylesheet" href="~/Content/themes/base/font/fontawesome-5.15.1/css/all.css">
    <style>
        .table-responsive {
            height: 212px;
        }
    </style>
    @{
        DateTime date = DateTime.Today;
        DateTime datedefault = Convert.ToDateTime("08/13/2000");
        string dateformated = date.Day.ToString() + "/" + date.Month.ToString() + "/" + date.Year.ToString();
    }
</head>

<body>

    <div class="row">

        <div class="col-lg-pull-3 thuan-body-content" style="margin-left: 5px;height: 485px; width:380px">
            <hr style=" margin-top: 43px" />

            <div class="panel-body">
                @using (Html.BeginForm("Index", "Nhapcapphat", FormMethod.Get))
                {
                    <div class="form-group">

                        <div class="form-group" style="display: flex ;  width:100%;align-items:center">
                            Từ
                            <input type="date" value="@Html.Raw(date)" class="form-control" style="width:138px; margin:0 8px" name="a" />
                            Đến
                            <input type="date" value="@Html.Raw(date)" class="form-control" style="width:138px; margin:0 8px" name="b" />
                        </div>

                        <div class="form-group" style="display: flex ;  width:100%;align-items:center">
                            @Html.TextBox("SearchString", null, new { @style = " height:38px; width:184px; margin:0 0 0px 26px", @class = "form-control", @placeholder = "Tìm kiếm phiếu nhập" })
                            <p>
                                <button title="Tìm kiếm" class="btn" type="submit" style="color:white; background-color:royalblue; margin-left:10px; margin-top:18px"><i class="fas fa-search" style="margin-right:0px"></i></button>
                            </p>
                        </div>
                    </div>
                }

                <hr style="margin-top:-8px" />
                <b class="panel-heading" style="color:coral; font-size:medium">
                    Danh sách phiếu đã nhập
                </b>
                <hr style="margin-top:15px;margin-bottom: unset" />

                @if (Model.PhieuxuatDTOs.Count() > 0)
                {
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Mã</th>
                                    <th>Ngày lập</th>
                                    <th style="width:115px"></th>
                                </tr>
                            </thead>

                            <tbody>
                                @foreach (var item in Model.PhieuxuatDTOs)
                                {
                                    <tr id="row_@item.Sophieuxuat">
                                        <td>@item.Sophieuxuat</td>
                                        @{DateTime a = @item.Ngaynhap;
                                            string b = a.Day.ToString() + "/" + a.Month.ToString() + "/" + a.Year.ToString();
                                        }
                                        <td style="width:98px">@Html.Raw(b)</td>
                                        <td>

                                            <a title="Sửa" href="/Admin/Nhapcapphat/Edithd/@item.Sophieuxuat"><i class="fas fa-pen" style="margin-right:5px"></i></a>|
                                            @Ajax.ActionLink(" ", "Deletehd", new { @id = item.Sophieuxuat }, new AjaxOptions
                                            { HttpMethod = "Delete", Confirm = "Bạn có muốn xoá bản ghi này?", OnComplete = "$('#row_" + @item.Sophieuxuat + "').remove()", },
                                            new { @class = "fas fa-trash", @title = "Xóa" })
                                            |<a title="Chi tiết" href="/Admin/Nhapcapphat/Detailhd/@item.Sophieuxuat"><i class="fas fa-info-circle" style="margin-left:5px"></i></a>
                                        </td>
                                    </tr>
                                }

                            </tbody>
                        </table>
                    </div>

                }
                else
                {
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Mã</th>
                                    <th>Ngày lập</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div class="alert alert-danger" style="width:210px; margin-top: -160px">Không tìm thấy dữ liệu</div>
                }

            </div>
        </div>

        <div class="col-lg-offset-1 thuan-body-content" style="margin-left: 14px; width:700px;height: 485px">
            <div class="panel-heading" style="color:coral;font-weight:bold;  font-size:large">
                Thông tin phiếu nhập
            </div>
            <hr />

            <div class="panel-body">
                @using (Html.BeginForm("Index", "Nhapcapphat", FormMethod.Get))
                {
                    <div class="form-group">
                        <div class="form-group" style="display: flex ;  width:100%;align-items:center">
                            <label style="margin-left: 7px;">Từ phiếu cấp phát</label>
                            <p id="intro">@Html.DropDownList("nguon", null, new { @style = "width:100px; margin:0 16px", @class = "form-control", @name = "nguon" })</p>
                            <p><button title="Xem phiếu xuất" type="submit" class="btn btn-primary" style="margin: -130px 0 -3px -57px;;"><i class="fas fa-eye"></i><b style="font-size: 14px;
                            margin-left: 5px;"> Xem</b></button></p>

                        </div>
                    </div>
                }
                @using (Html.BeginForm("MultiDelete", "Nhapcapphat", FormMethod.Post))
                {
                    <div class="panel-heading" style="color:blue; font-size:large; margin-top:-70px">
                        <button type="submit" title="Thêm phiếu nhập" class="btn btn-primary" style="margin: -120px 0px -3px 304px"><i class="fas fa-save"></i><b style="font-size: 14px;
                        margin-left: 5px;"> Lưu</b></button>
                    </div>

                    <div class="form-group" style="">
                        <div class="form-group" style="display: flex ;  width:100%;align-items:center; margin-top: -28px">

                            <label style="margin-left: 279px;">Ngày nhập</label>
                            <p><input type="datetime" name="ngaynhap" value="@Html.Raw(dateformated)" class="form-control" style="width:105px; margin:0 16px" readonly /></p>

                            <p><input value="@Html.Raw("5")" id="check" Checked name="check" type="checkbox" style="margin-left:10px; margin-right:10px " onclick="return false;" /></p>
                            <label>Xác nhận đã nhập</label>
                        </div>

                        <div class="form-group" style="display: flex ;  width:100%;align-items:center">

                            <label style=" box-sizing:border-box; flex-wrap:nowrap; margin-left: 10px;">Mã phiếu </label>
                            <p><input value="" id="sophieu" name="sophieu" class="form-control" style="width:100px;margin:0 16px" readonly /></p>

                            <label style="">Đơn vị nhập</label>
                            <p><input value="@ViewBag.tendt" class="form-control" style="width:170px;margin:0 16px" readonly /></p>

                            <label style=" box-sizing:border-box; flex-wrap:nowrap">Ghi chú</label>
                            <p><input class="form-control" style="width:92px;margin:0 16px" /></p>
                        </div>


                    </div>

                    <hr style="margin-top:-5px" />
                    <b class="panel-default" style="color: coral; font-size: medium">
                        Danh sách vaccine/ Vật tư nhập
                    </b>
                    <hr style="margin-bottom: unset;" />
                    if (Model.Dongxuats.Count() > 0)
                    {
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th>Số phiếu</th>
                                        <th>Mã lô</th>
                                        <th>Liều xuất</th>
                                        <th style="width:110px">Liều nhập</th>
                                        <th>Hạn sử dụng</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.Dongxuats)
                                    {
                                        if (item.HSD < DateTime.Now)
                                        {
                                            <tr id="2-@item.Madongxuat" class="red-row">
                                                @{DateTime a = @item.HSD;
                                                    string b = a.Day.ToString() + "/" + a.Month.ToString() + "/" + a.Year.ToString();
                                                }
                                                <td>@item.Sophieuxuat</td>
                                                <td>@item.Malo</td>
                                                <td style="text-align:center">@item.SLxuat</td>
                                                <td><input class="form-control" value=@item.SLxuat name="dsslhuy" id="dsslhuy" type="number" style="width:80px;margin-top: -5px; color:black; background-color:tomato" /></td>
                                                <td style="width:138px">@Html.Raw(b)</td>
                                            </tr>
                                        }

                                        else if ((item.HSD - DateTime.Now).TotalDays < 31)
                                        {
                                            <tr id="2-@item.Madongxuat" class="yellow-row">
                                                @{DateTime a = @item.HSD;
                                                    string b = a.Day.ToString() + "/" + a.Month.ToString() + "/" + a.Year.ToString();
                                                }
                                                <td>@item.Sophieuxuat</td>
                                                <td>@item.Malo</td>
                                                <td style="text-align:center">@item.SLxuat</td>
                                                <td><input class="form-control" value=@item.SLxuat name="dsslhuy" id="dsslhuy" type="number" style="width:80px;margin-top: -5px; color:black; background-color:yellow" /></td>
                                                <td style="width:138px">@Html.Raw(b)</td>
                                            </tr>
                                        }

                                        else
                                        {
                                            <tr id="2-@item.Madongxuat" class="2">
                                                @{DateTime a = @item.HSD;
                                                    string b = a.Day.ToString() + "/" + a.Month.ToString() + "/" + a.Year.ToString();
                                                }
                                                <td>@item.Sophieuxuat</td>
                                                <td>@item.Malo</td>
                                                <td style="text-align:center">@item.SLxuat</td>
                                                <td><input class="form-control" value=@item.SLxuat name="dsslhuy" id="dsslhuy" type="number" style="width:80px;margin-top: -5px; color:black" /></td>
                                                <td style="width:138px">@Html.Raw(b)</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>

                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th>Số phiếu</th>
                                        <th>Mã lô</th>
                                        <th>Liều xuất</th>
                                        <th>Liều nhập</th>
                                        <th>Hạn sử dụng</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                        <div class="alert alert-warning" style="width:180px ;margin-top: -160px">Chưa có dữ liệu</div>
                    }
                }
            </div>
        </div>
    </div>
</body>
